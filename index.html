<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDP QR-Code Generator</title>
    <style>
      body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }

      .form-group { margin-bottom: 20px;}

      label { display: block; margin-bottom: 10px; font-weight: bold; }

      select, input[type="text"] { padding: 10px; width: 300px; border: 1px solid #ddd; border-radius: 5px; }

      button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }

      button:hover { background-color: #0056b3; }

      a.button-style {
          padding: 10px 20px;
          background-color: #007bff;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          margin-bottom: 50px;
      }

      a.button-style:hover {
          background-color: #0056b3;
      }

      #bottomRightLabel {
            background-color: #626262; /* Light blue background */
            color: white; /* White text color */
            padding: 10px;
            margin-top: 100px;
            border-radius: 5px;
        }

    </style>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="qrcode.js"></script>
</head>
<body>

<h1 style="margin-bottom: 50px;">PDP QR-Code Generator</h1>
<!--Used to display qr code in svg format-->
<div id="qrCodeDiv" width="300" height="300" style="margin-bottom: 50px;">
    <img id="qrImage" src="qr_code_template.png" alt="QR Code Image" width="300" height="300" style="display:block;">
</div>

<a class="button-style" href="#" id="downloadQrCodeLink" download="qr_code.svg">Download</a>

<div class="form-group">
    <label for="urlInput">Enter URL:</label>
    <input type="text" id="urlInput" placeholder="https://yourUrl.com">
</div>

<div class="form-group">
    <label for="errorCorrection">Error Correction:</label>
    <select id="errorCorrection">
        <option value="L">L</option>
        <option value="M">M</option>
        <option value="Q">Q</option>
        <option value="H">H</option>
    </select>
</div>
<button id="generateBtn">Generate QR-Code</button>

<div id="bottomRightLabel">Powered by <a href="https://davidshimjs.github.io/qrcodejs/" target="_blank" style="color: inherit; text-decoration: none;">QRCode.js</a></div>

<script>

 let fileName = "qr_code.svg"

  document.getElementById('downloadQrCodeLink').addEventListener('click', function() {
    const url = document.getElementById('urlInput').value;
    var svg = document.querySelector('#qrCodeDiv svg');
    if(document.getElementById('qrCodeDiv').firstElementChild.tagName.toLowerCase() === 'svg'){
        var serializer = new XMLSerializer();
        var svgStr = serializer.serializeToString(svg);
        this.download = fileName;
        this.href = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgStr);
    }else{
        event.preventDefault();
        alert('Generate a QR-Code first!');
    }
  });

  document.getElementById('generateBtn').addEventListener('click', function() {
    // Here you would integrate a QR code generation library or API call to generate the QR code
    // For demonstration, let's just change the src attribute of the img tag to simulate QR code generation
    const url = document.getElementById('urlInput').value;
    const errorCorrection = document.getElementById('errorCorrection').value;

    // Placeholder for actual QR code generation
    console.log(`Generating QR code for URL: ${url} with Error Correction: ${errorCorrection}`);

    if (url.trim().length != 0) {
        // Example QR Code Image (Replace with actual QR code generation logic)
        var qrCodePlaceholder = document.getElementById("qrCodeDiv")
        while (qrCodePlaceholder.firstChild) {
            qrCodePlaceholder.removeChild(qrCodePlaceholder.firstChild);
        }

        var qrcode = new QRCode(qrCodePlaceholder, {
            text: url,
            width: 200,
            height: 200,
            colorDark : "#000000",
            colorLight : "#ffffff",
            correctLevel : getCorrectLevel(errorCorrection),
            useSVG: true
        });

        fileName = createFilenameFromUrl(url);
	}
  });
function getCorrectLevel(errorCorrection) {
    const levels = {
    "L": QRCode.CorrectLevel.L,
    "M": QRCode.CorrectLevel.M,
    "Q": QRCode.CorrectLevel.Q,
    "H": QRCode.CorrectLevel.H
    };
    return levels[errorCorrection] || QRCode.CorrectLevel.L; // Default to 'L' if not matched
}

function createFilenameFromUrl(url) {
  // Remove the protocol (http, https) and replace it with empty space
  let filename = url.replace(/^https?:\/\//, '');

  // Replace forward slashes (/) with hyphens (-) to avoid directory structure
  filename = filename.replace(/\//g, '-');

  // Replace characters that are not allowed in filenames
  filename = filename.replace(/[?<>\\:*|"]/g, '');

  // Optional: Replace periods with dashes to avoid file extensions being interpreted
  filename = filename.replace(/\./g, '-');

  // Replace consecutive hyphens with a single one
  filename = filename.replace(/-+/g, '-');

  // Truncate to a specific length if necessary, e.g., 255 characters
  //filename = filename.substring(0, 255);

  return filename;
}

</script>
</body>
</html>
